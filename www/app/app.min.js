var app;
(function(c){var d=function(){return function(l,b,f,c,d,g,h,k){"undefined"===typeof l&&(l=null);"undefined"===typeof b&&(b=null);"undefined"===typeof f&&(f=null);"undefined"===typeof c&&(c=!1);"undefined"===typeof d&&(d=new a);"undefined"===typeof g&&(g=[]);"undefined"===typeof h&&(h=[]);"undefined"===typeof k&&(k=[]);this.id=l;this.title=b;this.description=f;this.active=c;this.address=d;this.media=g;this.pricing=h;this.infrastructure=k}}();c.Spot=d;var b=function(){return function(a,b){"undefined"===typeof a&&
(a=0);"undefined"===typeof b&&(b=0);this.lat=a;this.lon=b}}();c.Position=b;var a=function(){return function(a,e,f){"undefined"===typeof a&&(a=new b);"undefined"===typeof e&&(e=0);"undefined"===typeof f&&(f=null);this.position=a;this.zip=e;this.city=f}}();c.Address=a;d=function(){return function(a){"undefined"===typeof a&&(a=null);this.url=a}}();c.Media=d;d=function(){return function(a,b){"undefined"===typeof a&&(a=null);"undefined"===typeof b&&(b=0);this.description=a;this.amount=b}}();c.Pricing=
d})(app||(app={}));
(function(c){var d=function(){function b(a,b,e,f,c,d,g,h){var k=this;this.offset=0;this.radius=3;this.choose=this.lon=this.lat=0;this.phrase=null;this.spots=[];this.showLoad=this.loading=!1;this.scope=a;this.scope.vm=this;this.http=b;this.location=e;this.window=f;this.resource=c;this.timeout=d;this.offlineService=g;this.geoService=h;this.geoService.current().then(function(a){k.lat=a.coords.latitude;k.lon=a.coords.longitude;k.loadNearby()})}b.prototype.reset=function(){this.offset=0;this.spots=[];
0==this.choose?this.loadNearby():this.loadByCity()};b.prototype.parseRadius=function(){this.radius=parseInt(this.radius.toString())};b.prototype.loadByCity=function(){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findByCity(this.phrase,this.offset).absoluteURL()).success(function(b,e){a.spots=a.spots.concat(b);a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==a.offset&&(a.showLoad=!0)}).error(function(b,e){a.loading=!1;a.offlineService.setOffline();
a.loadOffline();a.window.confirm("Unfortunately an error occurred. Try again?")&&a.loadByCity()})};b.prototype.loadNearby=function(){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findNearby(this.lat,this.lon,1E3*this.radius,this.offset).absoluteURL()).success(function(b,e){console.log(b);a.spots=a.spots.concat(b);a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==a.offset&&(a.showLoad=!0)}).error(function(b,e){a.loading=!1;a.offlineService.setOffline();
a.loadOffline();a.window.confirm("Unfortunately an error occurred. Try again?")&&a.loadNearby()})};b.prototype.redirect=function(a){this.location.path("/spot/"+a)};b.prototype.loadOffline=function(){var a=this;this.showLoad=!1;for(var b=0;10>b;b++)localforage.getItem("spot-"+b,function(b){b&&a.timeout(function(){return a.spots.push(b)})})};b.prototype.saveOffline=function(){this.spots.forEach(function(a,b,e){localforage.setItem("spot-"+b,a)})};b.$inject="$scope $http $location $window $resource $timeout offlineService geoService".split(" ");
return b}();c.HomeCtrl=d})(app||(app={}));
(function(c){var d=function(){function b(a,b,e,f,c,d,g){var h=this;this.media=[];this.pricing=[];this.edit=this.loading=!1;a.vm=this;this.scope=a;this.http=e;this.location=f;this.window=c;this.geoService=g;this.infrastructure=INFRASTRUCTURE;a=b.id||"new";"new"===a?this.createSpot():this.loadSpot(a);this.scope.$on("geocode",function(a,b,l){return h.geocodeFinished(b,l)})}b.prototype.addMedia=function(){this.media.push(new c.Media)};b.prototype.deleteMedia=function(a){this.media.splice(a,1)};b.prototype.addPricing=
function(){this.pricing.push(new c.Pricing(null,0))};b.prototype.deletePricing=function(a){this.pricing.splice(a,1)};b.prototype.showSummary=function(){this.scope.spotForm.$valid&&this.checkPosition()&&(this.loading=!0,this.geoService.geocode(this.spot.address))};b.prototype.toggleInfrastructure=function(a){var b=this.spot.infrastructure.indexOf(a);if(0<=b)return this.spot.infrastructure.splice(b,1),!1;this.spot.infrastructure.push(a);return!0};b.prototype.geocodeFinished=function(a,b){b?(this.window.alert(b),
this.loading=!1):this.edit?(this.spot.address=a,this.save()):(this.spot.address=a,this.insert())};b.prototype.insert=function(){var a=this;this.loading=!0;this.handleMedias();this.http.post(jsRoutes.controllers.Application.createSpot().absoluteURL(),this.spot).success(function(b,e){a.spot=b;a.location.path("/spot/"+a.spot.id)}).error(function(b,e){a.loading=!1;a.window.alert("Unfortunately an error occurred. Please try again later.")})};b.prototype.save=function(){var a=this;this.loading=!0;this.handleMedias();
this.handlePricings();this.http.put(jsRoutes.controllers.Application.updateSpot().absoluteURL(),this.spot).success(function(b,e){a.spot=b;a.location.path("/spot/"+a.spot.id)}).error(function(b,e){a.window.alert("Unfortunately an error occurred. Please try again later.")})};b.prototype.handleMedias=function(){for(var a=this.media.length;a--;)this.media[a].url||this.media.splice(a,1);this.spot.media=this.spot.media.concat(this.media)};b.prototype.handlePricings=function(){for(var a=this.pricing.length;a--;)this.pricing[a].description||
this.pricing.splice(a,1);this.spot.pricing=this.spot.pricing.concat(this.pricing)};b.prototype.createSpot=function(){this.edit=!1;this.spot=new c.Spot;this.spot.address=new c.Address;this.createMap()};b.prototype.loadSpot=function(a){var b=this;this.edit=!0;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,f){b.spot=a;b.spot||b.location.path("/404").replace()}).error(function(a,f){b.location.path("/404").replace()})};b.prototype.checkPosition=function(){console.log(this.spot.address.position);
return 0==this.spot.address.position.lat&&0==this.spot.address.position.lon?(this.window.alert("no point set"),!1):!0};b.prototype.createMap=function(){var a=this,b=L.map("map").setView([51.505,-0.09],13),e=null;this.geoService.current().then(function(a){console.log(a);b.setView([51.505,-0.09],13);e=L.marker([a.coords.latitude,a.coords.longitude]).addTo(b)});b.on("click",function(c){a.spot.address.position.lat=c.latlng.lat;a.spot.address.position.lon=c.latlng.lng;e?e.setLatLng(c.latlng):e=L.marker([c.latlng.lat,
c.latlng.lng]).addTo(b);console.log(a.spot.address.position)})};b.$inject="$scope $routeParams $http $location $window $timeout geoService".split(" ");return b}();c.EditSpotCtrl=d})(app||(app={}));
(function(c){var d=function(){function b(a,b,e,c,d,m,g){var h=this;this.hasImage=!1;this.slideIndex=0;this.finished=!1;this.scope=a;this.scope.vm=this;this.http=b;this.location=e;this.window=m;this.sce=d;this.offlineService=g;this.oratio=this.sce.trustAsResourceUrl("//www.orat.io/js/widget/stmt.inc.min.js");this.loadSpot(c.id||"0");this.scope.$on("online",function(a){h.loadFinish()})}b.prototype.loadSpot=function(a){var b=this;localforage.getItem(a,function(c){b.spot=c;b.spot?(b.offlineService.isOnline()&&
b.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,b){console.log(a);localforage.setItem(a.id,a)}).error(function(a,d){localforage.removeItem(c.id);b.location.path("/404")}),b.loadFinish()):b.loadRemote(a)})};b.prototype.loadRemote=function(a){var b=this;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,c){a?(b.spot=a,b.spot.active?b.loadFinish():b.location.path("/404")):b.location.path("/404").replace()}).error(function(a,
c){b.location.path("/404").replace()})};b.prototype.loadFinish=function(){this.checkImages();this.loadMap()};b.prototype.checkImages=function(){this.spot.media&&0<this.spot.media.length&&(this.hasImage=!0)};b.prototype.loadMap=function(){var a=this.spot.address.position.lat,b=this.spot.address.position.lon,c=L.map("map").setView([a,b],13);L.marker([a,b]).addTo(c)};b.$inject="$scope $http $location $routeParams $sce $window offlineService".split(" ");return b}();c.SpotCtrl=d})(app||(app={}));
(function(c){var d=function(){function b(a,b,c){this.rootScope=a;this.http=b;this.geolocation=c}b.prototype.current=function(){return this.geolocation.getLocation()};b.prototype.geocode=function(a){a.position.lat=52.52000659999999;a.position.lon=13.404953999999975;a.zip=10969;a.city="Berlin";this.rootScope.$broadcast("geocode",a,null)};b.$inject=["$rootScope","$http","geolocation"];return b}();c.GeoService=d})(app||(app={}));
(function(c){var d=function(){function b(a){this.offline=!0;this.rootScope=a}b.prototype.setOnline=function(){$("#offline").hide();var a=this.offline;this.offline=!1;a&&this.rootScope.$broadcast("online")};b.prototype.setOffline=function(){$("#offline").show();var a=!this.offline;this.offline=!0;a&&this.rootScope.$broadcast("offline")};b.prototype.isOnline=function(){return!this.offline};b.prototype.isOffline=function(){return this.offline};b.$inject=["$rootScope"];return b}();c.OfflineService=d})(app||
(app={}));
(function(c){var d=function(){function b(a,b,c){var d=this;this.loading=!1;this.percentage=0;this.http=a;this.window=b;this.upload=c;this.templateUrl="partials/templates/imageUpload.html";this.restrict="E";this.link=function(a,b,c){return d.linkFn(a,b,c)}}b.prototype.injection=function(){return["$http","$window","$upload",function(a,c,d){return new b(a,c,d)}]};b.prototype.linkFn=function(a,b,c){var d=this;this.myScope=a;this.myScope.imgvm=this;this.myScope.onFileSelect=function(a){return d.handleUpload(a,b)}};
b.prototype.handleUpload=function(a,b){var c=this;this.loading=!0;for(var d=0;d<a.length;d++)this.myScope.upload=this.upload.upload({url:"/upload",method:"POST",file:a[d]}).progress(function(a){return console.log("percent: "+100*a.loaded/a.total)}).success(function(a,b,d,f){c.myScope.picture.url="/res/"+a.url;c.loading=!1}).error(function(){return c.window.alert("Unfortunately an error occurred. Please try again later.")})};return b}();c.ImgUpload=d})(app||(app={}));
(function(c){var d=function(){function b(a){var b=this;this.templateUrl="partials/templates/widget.html";this.restrict="E";this.scope={spot:"=spot"};this.timeout=a;this.link=function(a,c,d){return b.linkFn(a,c,d)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,c){localforage.setItem(a.spot.id,a.spot);this.evaluate(a)};b.prototype.evaluate=function(a){0<a.spot.media.length?(a.spot.hasImage=!0,a.spot.image=a.spot.media[0].url):a.spot.hasImage=
!1};return b}();c.Widget=d})(app||(app={}));
(function(c){var d=function(){function b(a){var b=this;this.timeout=a;this.templateUrl="partials/templates/widgetImg.html";this.restrict="E";this.link=function(a,c,d){return b.linkFn(a,c,d)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,c){this.handleResize(a)};b.prototype.handleResize=function(a){a.width=$("#spot-images").width();a.height=Math.round(a.width/2)};return b}();c.WidgetImg=d})(app||(app={}));
(function(c){var d=angular.module("ub","ngRoute ngResource shoppinpal.mobile-menu ng-back angularFileUpload filters angular-carousel angulartics angulartics.google.analytics pascalprecht.translate geolocation".split(" "));d.controller("homeCtrl",c.HomeCtrl);d.controller("editSpotCtrl",c.EditSpotCtrl);d.controller("spotCtrl",c.SpotCtrl);d.service("geoService",c.GeoService);d.service("offlineService",c.OfflineService);d.directive("imgUpload",c.ImgUpload.prototype.injection());d.directive("widget",c.Widget.prototype.injection());
d.directive("widgetImg",c.WidgetImg.prototype.injection());d.config(["$routeProvider",function(b){b.when("/home",{templateUrl:"partials/home.html",controller:"homeCtrl"}).when("/new",{templateUrl:"partials/new.html",controller:"editSpotCtrl"}).when("/edit/:id",{templateUrl:"partials/new.html",controller:"editSpotCtrl"}).when("/spot/:id",{templateUrl:"partials/spot.html",controller:"spotCtrl"}).when("/imprint",{templateUrl:"partials/footer/imprint.html"}).when("/about",{templateUrl:"partials/footer/about.html"}).when("/terms",
{templateUrl:"partials/footer/terms.html"}).when("/404",{templateUrl:"partials/404.html"}).otherwise({redirectTo:"/home"})}]);d.config(["$translateProvider",function(b){b.useStaticFilesLoader({prefix:"app/languages/",suffix:".json"}).preferredLanguage(LANGUAGE)}]);d.run(["$rootScope","$http","offlineService",function(b,a,c){b.$on("$routeChangeStart",function(b,d,n){a.get("http://localhost:9000/ping").success(function(a,b){c.setOnline()}).error(function(a,b){c.setOffline()})})}])})(app||(app={}));
