var app;
(function(d){var e=function(){return function(f,c,b,d,e,h,k,g){"undefined"===typeof f&&(f=null);"undefined"===typeof c&&(c=null);"undefined"===typeof b&&(b=null);"undefined"===typeof d&&(d=!1);"undefined"===typeof e&&(e=new a);"undefined"===typeof h&&(h=[]);"undefined"===typeof k&&(k=[]);"undefined"===typeof g&&(g=[]);this.id=f;this.title=c;this.description=b;this.active=d;this.address=e;this.media=h;this.pricing=k;this.infrastructure=g}}();d.Spot=e;var b=function(){return function(a,c){"undefined"===typeof a&&
(a=0);"undefined"===typeof c&&(c=0);this.lat=a;this.lon=c}}();d.Position=b;var a=function(){return function(a,c,d){"undefined"===typeof a&&(a=new b);"undefined"===typeof c&&(c=0);"undefined"===typeof d&&(d=null);this.position=a;this.zip=c;this.city=d}}();d.Address=a;e=function(){return function(a){"undefined"===typeof a&&(a=null);this.url=a}}();d.Media=e;e=function(){return function(a,c){"undefined"===typeof a&&(a=null);"undefined"===typeof c&&(c=0);this.description=a;this.amount=c}}();d.Pricing=
e})(app||(app={}));(function(d){var e=function(){function b(){}b.$inject=[];return b}();d.MenuCtrl=e})(app||(app={}));
(function(d){var e=function(){function b(a,f,c,b,d,e,h,k){var g=this;this.offset=0;this.radius=3;this.choose=this.lon=this.lat=0;this.phrase=null;this.spots=[];this.showLoad=this.loading=!1;this.scope=a;this.scope.vm=this;this.http=f;this.location=c;this.window=b;this.resource=d;this.timeout=e;this.offlineService=h;this.geoService=k;this.geoService.current().then(function(a){g.lat=a.coords.latitude;g.lon=a.coords.longitude;g.loadNearby()});this.window.onscroll=function(a){a=$(window).innerHeight()+
$(window).scrollTop();var c=$(document).height();a+200>=c&&g.showLoad&&(0==g.choose?g.loadNearby():g.loadByCity())}}b.prototype.reset=function(){this.offset=0;this.spots=[];0==this.choose?this.loadNearby():this.loadByCity()};b.prototype.parseRadius=function(){this.radius=parseInt(this.radius.toString())};b.prototype.loadByCity=function(){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findByCity(this.phrase,this.offset).absoluteURL()).success(function(f,c){a.spots=a.spots.concat(f);
a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==a.offset&&(a.showLoad=!0)}).error(function(f,c){a.loading=!1;a.offlineService.setOffline();a.loadOffline()})};b.prototype.loadNearby=function(){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findNearby(this.lat,this.lon,1E3*this.radius,this.offset).absoluteURL()).success(function(f,c){a.spots=a.spots.concat(f);a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==
a.offset&&(a.showLoad=!0)}).error(function(f,c){a.loading=!1;a.offlineService.setOffline();a.loadOffline()})};b.prototype.redirect=function(a){this.location.path("/app/spot/"+a)};b.prototype.loadOffline=function(){var a=this;this.showLoad=!1;for(var f=0;10>f;f++)localforage.getItem("spot-"+f,function(c){c&&a.timeout(function(){return a.spots.push(c)})})};b.prototype.saveOffline=function(){this.spots.forEach(function(a,f,c){localforage.setItem("spot-"+f,a)})};b.$inject="$scope $http $location $window $resource $timeout offlineService geoService".split(" ");
return b}();d.HomeCtrl=e})(app||(app={}));
(function(d){var e=function(){function b(a,f,c,b,d,e,h,k){var g=this;this.media=[];this.pricing=[];this.pointSet=this.edit=this.loading=!1;a.vm=this;this.scope=a;this.http=c;this.location=b;this.window=d;this.timeout=e;this.geoService=h;this.offlineService=k;this.infrastructure=INFRASTRUCTURE;this.offlineService.isOnline()?(a=f.id||"new","new"===a?this.createSpot():this.loadSpot(a)):this.location.path("/app/offline");this.scope.$on("geocode",function(a,c,f){return g.geocodeFinished(c,f)})}b.prototype.addMedia=
function(){this.media.push(new d.Media)};b.prototype.deleteMedia=function(a){this.media.splice(a,1)};b.prototype.addPricing=function(){this.pricing.push(new d.Pricing(null,0))};b.prototype.deletePricing=function(a){this.pricing.splice(a,1)};b.prototype.showSummary=function(){this.loading=!0;this.geoService.geocode(this.spot.address)};b.prototype.toggleInfrastructure=function(a){var f=this.spot.infrastructure.indexOf(a);if(0<=f)return this.spot.infrastructure.splice(f,1),!1;this.spot.infrastructure.push(a);
return!0};b.prototype.geocodeFinished=function(a,f){f?(this.window.alert(f),this.loading=!1):this.edit?(this.spot.address=a,this.save()):(this.spot.address=a,this.insert())};b.prototype.insert=function(){var a=this;this.loading=!0;this.handleMedias();this.handlePricings();this.http.post(jsRoutes.controllers.Application.createSpot().absoluteURL(),this.spot).success(function(f,c){a.spot=f;a.location.path("/app/spot/"+a.spot.id)}).error(function(f,c){a.loading=!1})};b.prototype.save=function(){var a=
this;this.loading=!0;this.handleMedias();this.handlePricings();this.http.put(jsRoutes.controllers.Application.updateSpot().absoluteURL(),this.spot).success(function(f,c){a.spot=f;a.location.path("/app/spot/"+a.spot.id)}).error(function(a,c){})};b.prototype.handleMedias=function(){for(var a=this.media.length;a--;)this.media[a].url||this.media.splice(a,1);this.spot.media=this.spot.media.concat(this.media)};b.prototype.handlePricings=function(){for(var a=this.pricing.length;a--;)this.pricing[a].description||
this.pricing.splice(a,1);this.spot.pricing=this.spot.pricing.concat(this.pricing)};b.prototype.createSpot=function(){this.edit=!1;this.spot=new d.Spot;this.spot.address=new d.Address;this.createMap()};b.prototype.loadSpot=function(a){var f=this;this.pointSet=this.edit=!0;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,b){f.spot=a;console.log(f.spot);f.spot||f.location.path("/app/404").replace()}).error(function(a,b){f.location.path("/app/404").replace()})};
b.prototype.createMap=function(){var a=this,f=null;this.geoService.current().then(function(a){c.setCenter(new google.maps.LatLng(a.coords.latitude,a.coords.longitude))});var c=new google.maps.Map(document.getElementById("map"),{center:{lat:48.20817400000001,lng:16.373819},zoom:15});google.maps.event.addListener(c,"click",function(b){var d=b.latLng.lat(),e=b.latLng.lng();a.spot.address.position.lat=d;a.spot.address.position.lon=e;a.timeout(function(){return a.pointSet=!0});null==f?f=new google.maps.Marker({position:b.latLng,
map:c}):f.setPosition(b.latLng)})};b.$inject="$scope $stateParams $http $location $window $timeout geoService offlineService".split(" ");return b}();d.EditSpotCtrl=e})(app||(app={}));
(function(d){var e=function(){function b(a,b,c,d,e,l,h){var k=this;this.hasImage=!1;this.slideIndex=0;this.finished=!1;this.scope=a;this.scope.vm=this;this.http=b;this.location=c;this.window=l;this.sce=e;this.offlineService=h;this.oratio=this.sce.trustAsResourceUrl("//www.orat.io/js/widget/stmt.inc.min.js");this.loadSpot(d.id||"0");this.scope.$on("online",function(a){k.loadFinish()})}b.prototype.loadSpot=function(a){var b=this;localforage.getItem(a,function(c){b.spot=c;b.spot?(b.offlineService.isOnline()&&
b.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,b){localforage.setItem(a.id,a)}).error(function(a,d){localforage.removeItem(c.id);b.location.path("/app/404")}),b.loadFinish()):b.loadRemote(a)})};b.prototype.loadRemote=function(a){var b=this;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,d){a?(b.spot=a,b.spot.active?b.loadFinish():b.location.path("/app/404")):b.location.path("/app/404").replace()}).error(function(a,
d){b.location.path("/app/404").replace()})};b.prototype.loadFinish=function(){this.checkImages();this.loadMap()};b.prototype.checkImages=function(){this.spot.media&&0<this.spot.media.length&&(this.hasImage=!0)};b.prototype.loadMap=function(){var a=this.spot.address.position.lat,b=this.spot.address.position.lon,c=L.map("map").setView([a,b],13);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(c);
L.marker([a,b]).addTo(c)};b.$inject="$scope $http $location $stateParams $sce $window offlineService".split(" ");return b}();d.SpotCtrl=e})(app||(app={}));
(function(d){var e=function(){function b(a,b,c){this.rootScope=a;this.http=b;this.geolocation=c}b.prototype.current=function(){return this.geolocation.getLocation()};b.prototype.geocode=function(a){var b=this;this.http.get("http://nominatim.openstreetmap.org/reverse?format=json&addressdetails=1&accept-language=en&lat="+a.position.lat+"&lon="+a.position.lon,{withCredentials:!1}).success(function(c,d){c&&c.address?(a.city=c.address.city||c.address.town||c.address.village||!c.address.hamlet?c.address.city||
c.address.town||!c.address.village?!c.address.city&&c.address.town?c.address.town:c.address.city&&"Gemeinde Wien"===c.address.city?"Vienna":c.address.city?c.address.city:c.address.state:c.address.village:c.address.hamlet,a.zip=parseInt(c.address.postcode),b.rootScope.$broadcast("geocode",a,null)):b.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")}).error(function(a,d){return b.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")})};
b.$inject=["$rootScope","$http","geolocation"];return b}();d.GeoService=e})(app||(app={}));
(function(d){var e=function(){function b(a){this.offline=!1;this.rootScope=a}b.prototype.setOnline=function(){$("#offline").hide();var a=this.offline;this.offline=!1;a&&this.rootScope.$broadcast("online")};b.prototype.setOffline=function(){$("#offline").show();var a=!this.offline;this.offline=!0;a&&this.rootScope.$broadcast("offline")};b.prototype.isOnline=function(){return!this.offline};b.prototype.isOffline=function(){return this.offline};b.$inject=["$rootScope"];return b}();d.OfflineService=e})(app||
(app={}));
(function(d){var e=function(){function b(a,b,c){var d=this;this.loading=!1;this.percentage=0;this.http=a;this.window=b;this.upload=c;this.templateUrl="partials/templates/imageUpload.html";this.restrict="E";this.link=function(a,b,c){return d.linkFn(a,b,c)}}b.prototype.injection=function(){return["$http","$window","$upload",function(a,f,c){return new b(a,f,c)}]};b.prototype.linkFn=function(a,b,c){var d=this;this.myScope=a;this.myScope.imgvm=this;this.myScope.onFileSelect=function(a){return d.handleUpload(a,b)}};
b.prototype.handleUpload=function(a,b){var c=this;console.log(a);this.loading=!0;for(var d=0;d<a.length;d++)this.myScope.upload=this.upload.upload({url:SERVER+"/upload",method:"POST",file:a[d]}).progress(function(a){return console.log("percent: "+100*a.loaded/a.total)}).success(function(a,b,d,f){console.log(a.url);c.myScope.picture.url=SERVER+"/res/"+a.url;c.loading=!1}).error(function(){return c.window.alert("Unfortunately an error occurred. Please try again later.")})};return b}();d.ImgUpload=e})(app||
(app={}));
(function(d){var e=function(){function b(a){var b=this;this.templateUrl="partials/templates/widget.html";this.restrict="E";this.scope={spot:"=spot"};this.timeout=a;this.link=function(a,d,e){return b.linkFn(a,d,e)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,c){localforage.setItem(a.spot.id,a.spot);this.evaluate(a)};b.prototype.evaluate=function(a){0<a.spot.media.length?(a.spot.hasImage=!0,a.spot.image=a.spot.media[0].url):a.spot.hasImage=
!1;1<=a.spot.pricing.length&&(a.spot.min=a.spot.pricing[0].amount,a.spot.max=a.spot.pricing[0].amount,a.spot.pricing.forEach(function(b,c,d){b.amount<a.spot.min&&(a.spot.min=b.amount);b.amount>a.spot.max&&(a.spot.max=b.amount)}))};return b}();d.Widget=e})(app||(app={}));
(function(d){var e=function(){function b(a){var b=this;this.timeout=a;this.templateUrl="partials/templates/widgetImg.html";this.restrict="E";this.link=function(a,d,e){return b.linkFn(a,d,e)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,c){this.handleResize(a)};b.prototype.handleResize=function(a){a.width=$("#spot-images").width();a.height=Math.round(a.width/2)};return b}();d.WidgetImg=e})(app||(app={}));
(function(d){var e=angular.module("ub","ngRoute ngResource ionic ng-back angularFileUpload filters angular-carousel angulartics angulartics.google.analytics pascalprecht.translate geolocation".split(" "));e.run(function(b){b.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0);window.StatusBar&&StatusBar.styleDefault()})});e.controller("homeCtrl",d.HomeCtrl);e.controller("menuCtrl",d.MenuCtrl);e.controller("editSpotCtrl",d.EditSpotCtrl);
e.controller("spotCtrl",d.SpotCtrl);e.service("geoService",d.GeoService);e.service("offlineService",d.OfflineService);e.directive("imgUpload",d.ImgUpload.prototype.injection());e.directive("widget",d.Widget.prototype.injection());e.directive("widgetImg",d.WidgetImg.prototype.injection());e.config(function(b,a){b.state("app",{url:"/app",abstract:!0,templateUrl:"partials/menu.html",controller:"menuCtrl"}).state("app.home",{url:"/home",views:{menuContent:{templateUrl:"partials/home.html",controller:"homeCtrl"}}}).state("app.new",
{url:"/new",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.edit",{url:"/edit/:id",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.spot",{url:"/spot/:id",views:{menuContent:{templateUrl:"partials/spot.html",controller:"spotCtrl"}}}).state("app.404",{url:"/404",views:{menuContent:{templateUrl:"partials/404.html"}}}).state("app.offline",{url:"/offline",views:{menuContent:{templateUrl:"partials/offline.html"}}}).state("app.about",
{url:"/about",views:{menuContent:{templateUrl:"partials/footer/about.html"}}}).state("app.terms",{url:"/terms",views:{menuContent:{templateUrl:"partials/footer/terms.html"}}});a.otherwise("/app/home")});e.config(["$translateProvider",function(b){b.useStaticFilesLoader({prefix:"app/languages/",suffix:".json"}).preferredLanguage(LANGUAGE)}]);e.run(["$rootScope","$http","offlineService",function(b,a,d){b.$on("$stateChangeStart",function(b,e,m){a.get(SERVER+"/ping").success(function(a,b){d.setOnline()}).error(function(a,
b){d.setOffline()})})}])})(app||(app={}));
