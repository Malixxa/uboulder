var app;
(function(c){var e=function(){return function(f,d,b,c,e,g,k,l){"undefined"===typeof f&&(f=null);"undefined"===typeof d&&(d=null);"undefined"===typeof b&&(b=null);"undefined"===typeof c&&(c=!1);"undefined"===typeof e&&(e=new a);"undefined"===typeof g&&(g=[]);"undefined"===typeof k&&(k=[]);"undefined"===typeof l&&(l=[]);this.id=f;this.title=d;this.description=b;this.active=c;this.address=e;this.media=g;this.pricing=k;this.infrastructure=l}}();c.Spot=e;var b=function(){return function(a,d){"undefined"===typeof a&&
(a=0);"undefined"===typeof d&&(d=0);this.lat=a;this.lon=d}}();c.Position=b;var a=function(){return function(a,d,h){"undefined"===typeof a&&(a=new b);"undefined"===typeof d&&(d=0);"undefined"===typeof h&&(h=null);this.position=a;this.zip=d;this.city=h}}();c.Address=a;e=function(){return function(a){"undefined"===typeof a&&(a=null);this.url=a}}();c.Media=e;e=function(){return function(a,d){"undefined"===typeof a&&(a=null);"undefined"===typeof d&&(d=0);this.description=a;this.amount=d}}();c.Pricing=
e})(app||(app={}));(function(c){var e=function(){function b(){}b.$inject=[];return b}();c.MenuCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,f,d,b,c,e){var g=this;this.radius=3;this.choose=this.lon=this.lat=0;this.phrase=null;this.scope=a;this.scope.vm=this;this.location=f;this.window=d;this.offlineService=b;this.geoService=c;this.spotService=e;this.cities=CITIES;this.geoService.current().then(function(a){g.lat=a.coords.latitude;g.lon=a.coords.longitude;g.loadNearby()});this.window.onscroll=function(a){a=$(window).innerHeight()+$(window).scrollTop();var f=$(document).height();a+200>=f&&g.spotService.showLoad&&
(0==g.choose?g.spotService.loadNearby(g.lat,g.lon,g.radius):g.spotService.loadByCity(g.phrase))}}b.prototype.reset=function(){this.spotService.reset();0==this.choose?this.loadNearby():this.loadByCity()};b.prototype.parseRadius=function(){this.radius=parseInt(this.radius.toString())};b.prototype.redirect=function(a){this.location.path("/app/spot/"+a)};b.prototype.loadByCity=function(){this.spotService.loadByCity(this.phrase)};b.prototype.loadNearby=function(){this.spotService.loadNearby(this.lat,this.lon,
this.radius)};b.$inject="$scope $location $window offlineService geoService spotService".split(" ");return b}();c.HomeCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,f,d,b,c,e,g,k){this.media=[];this.pricing=[];this.pointSet=this.edit=this.loading=!1;a.vm=this;this.scope=a;this.http=d;this.location=b;this.window=c;this.timeout=e;this.geoService=g;this.offlineService=k;this.infrastructure=INFRASTRUCTURE;this.offlineService.isOnline()?(a=f.id||"new","new"===a?this.createSpot():this.loadSpot(a)):this.location.path("/app/offline")}b.prototype.addMedia=function(){this.media.push(new c.Media)};b.prototype.deleteMedia=function(a){this.media.splice(a,
1)};b.prototype.addPricing=function(){this.pricing.push(new c.Pricing(null,0))};b.prototype.deletePricing=function(a){this.pricing.splice(a,1)};b.prototype.showSummary=function(){this.loading=!0;this.edit?this.save():this.insert()};b.prototype.toggleInfrastructure=function(a){var f=this.spot.infrastructure.indexOf(a);if(0<=f)return this.spot.infrastructure.splice(f,1),!1;this.spot.infrastructure.push(a);return!0};b.prototype.insert=function(){var a=this;this.loading=!0;this.handleMedias();this.handlePricings();
this.http.post(jsRoutes.controllers.Application.createSpot().absoluteURL(),this.spot).success(function(f,d){a.spot=f;a.location.path("/app/spot/"+a.spot.id)}).error(function(f,d){a.loading=!1})};b.prototype.save=function(){var a=this;this.loading=!0;this.handleMedias();this.handlePricings();this.http.put(jsRoutes.controllers.Application.updateSpot().absoluteURL(),this.spot).success(function(f,d){a.spot=f;a.location.path("/app/spot/"+a.spot.id)}).error(function(a,d){})};b.prototype.handleMedias=function(){for(var a=
this.media.length;a--;)this.media[a].url||this.media.splice(a,1);this.spot.media=this.spot.media.concat(this.media)};b.prototype.handlePricings=function(){for(var a=this.pricing.length;a--;)this.pricing[a].description||this.pricing.splice(a,1);this.spot.pricing=this.spot.pricing.concat(this.pricing)};b.prototype.createSpot=function(){this.edit=!1;this.spot=new c.Spot;this.spot.address=new c.Address;this.createMap()};b.prototype.loadSpot=function(a){var f=this;this.pointSet=this.edit=!0;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,
b){f.spot=a;console.log(f.spot);f.spot||f.location.path("/app/404").replace()}).error(function(a,b){f.location.path("/app/404").replace()})};b.prototype.createMap=function(){var a=this,f=null;this.geoService.current().then(function(a){b.setCenter(new google.maps.LatLng(a.coords.latitude,a.coords.longitude))});var b=new google.maps.Map(document.getElementById("map"),{center:{lat:48.20817400000001,lng:16.373819},zoom:15});google.maps.event.addListener(b,"click",function(h){var c=h.latLng.lat(),e=h.latLng.lng();
a.spot.address.position.lat=c;a.spot.address.position.lon=e;a.timeout(function(){return a.pointSet=!0});a.geocode(h.latLng);null==f?f=new google.maps.Marker({position:h.latLng,map:b}):f.setPosition(h.latLng)})};b.prototype.geocode=function(a){var f=this;(new google.maps.Geocoder).geocode({latLng:a},function(a,b){b==google.maps.GeocoderStatus.OK&&(0<a.length?a[0].address_components.forEach(function(a,b,d){a.types.forEach(function(b,d,h){"postal_code"==b&&(f.spot.address.zip=parseInt(a.long_name));
"locality"==b&&(f.spot.address.city=a.long_name)})}):f.pointSet=!1)})};b.$inject="$scope $stateParams $http $location $window $timeout geoService offlineService".split(" ");return b}();c.EditSpotCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,b,d,h,c,e,g){var k=this;this.hasImage=!1;this.slideIndex=0;this.finished=!1;this.scope=a;this.scope.vm=this;this.http=b;this.location=d;this.window=e;this.sce=c;this.offlineService=g;this.oratio=this.sce.trustAsResourceUrl("//www.orat.io/js/widget/stmt.inc.min.js");this.loadSpot(h.id||"0");this.scope.$on("online",function(a){k.loadFinish()})}b.prototype.loadSpot=function(a){var b=this;localforage.getItem(a,function(d){b.spot=d;b.spot?(b.offlineService.isOnline()&&
b.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,b){localforage.setItem(a.id,a)}).error(function(a,c){localforage.removeItem(d.id);b.location.path("/app/404")}),b.loadFinish()):b.loadRemote(a)})};b.prototype.loadRemote=function(a){var b=this;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,c){a?(b.spot=a,b.spot.active?b.loadFinish():b.location.path("/app/404")):b.location.path("/app/404").replace()}).error(function(a,
c){b.location.path("/app/404").replace()})};b.prototype.loadFinish=function(){this.checkImages();this.loadMap()};b.prototype.checkImages=function(){this.spot.media&&0<this.spot.media.length&&(this.hasImage=!0)};b.prototype.loadMap=function(){var a=this.spot.address.position.lat,b=this.spot.address.position.lon,d=L.map("map").setView([a,b],13);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(d);
L.marker([a,b]).addTo(d)};b.$inject="$scope $http $location $stateParams $sce $window offlineService".split(" ");return b}();c.SpotCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,b,d){this.rootScope=a;this.http=b;this.geolocation=d}b.prototype.current=function(){return this.geolocation.getLocation()};b.prototype.geocode=function(a){var b=this;this.http.get("http://nominatim.openstreetmap.org/reverse?format=json&addressdetails=1&accept-language=en&lat="+a.position.lat+"&lon="+a.position.lon,{withCredentials:!1}).success(function(d,c){d&&d.address?(a.city=d.address.city||d.address.town||d.address.village||!d.address.hamlet?d.address.city||
d.address.town||!d.address.village?!d.address.city&&d.address.town?d.address.town:d.address.city&&"Gemeinde Wien"===d.address.city?"Vienna":d.address.city?d.address.city:d.address.state:d.address.village:d.address.hamlet,a.zip=parseInt(d.address.postcode),b.rootScope.$broadcast("geocode",a,null)):b.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")}).error(function(a,c){return b.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")})};
b.$inject=["$rootScope","$http","geolocation"];return b}();c.GeoService=e})(app||(app={}));
(function(c){var e=function(){function b(a){this.offline=!1;this.rootScope=a}b.prototype.setOnline=function(){$("#offline").hide();var a=this.offline;this.offline=!1;a&&this.rootScope.$broadcast("online")};b.prototype.setOffline=function(){$("#offline").show();var a=!this.offline;this.offline=!0;a&&this.rootScope.$broadcast("offline")};b.prototype.isOnline=function(){return!this.offline};b.prototype.isOffline=function(){return this.offline};b.$inject=["$rootScope"];return b}();c.OfflineService=e})(app||
(app={}));
(function(c){var e=function(){function b(a,b,d,c){this.spots=[];this.showLoad=this.loading=!1;this.offset=0;this.rootScope=a;this.http=b;this.timeout=d;this.offlineService=c}b.prototype.loadByCity=function(a){var b=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findByCity(a,this.offset).absoluteURL()).success(function(a,c){b.spots=b.spots.concat(a);b.offset+=10;b.loading=!1;b.offlineService.setOnline();b.saveOffline();b.spots.length==b.offset&&(b.showLoad=!0)}).error(function(a,c){b.loading=
!1;b.offlineService.setOffline();b.loadOffline()})};b.prototype.loadNearby=function(a,b,d){var c=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findNearby(a,b,1E3*d,this.offset).absoluteURL()).success(function(a,b){c.spots=c.spots.concat(a);c.offset+=10;c.loading=!1;c.offlineService.setOnline();c.saveOffline();c.spots.length==c.offset&&(c.showLoad=!0)}).error(function(a,b){c.loading=!1;c.offlineService.setOffline();c.loadOffline()})};b.prototype.reset=function(){this.offset=0;
this.spots=[]};b.prototype.loadOffline=function(){var a=this;this.showLoad=!1;for(var b=0;10>b;b++)localforage.getItem("spot-"+b,function(b){b&&a.timeout(function(){return a.spots.push(b)})})};b.prototype.saveOffline=function(){this.spots.forEach(function(a,b,d){localforage.setItem("spot-"+b,a)})};b.$inject=["$rootScope","$http","$timeout","offlineService"];return b}();c.SpotService=e})(app||(app={}));
(function(c){var e=function(){function b(a,b,d){var c=this;this.loading=!1;this.percentage=0;this.http=a;this.window=b;this.upload=d;this.templateUrl="partials/templates/imageUpload.html";this.restrict="E";this.link=function(a,b,d){return c.linkFn(a,b,d)}}b.prototype.injection=function(){return["$http","$window","$upload",function(a,c,d){return new b(a,c,d)}]};b.prototype.linkFn=function(a,b,c){var e=this;this.myScope=a;this.myScope.imgvm=this;this.myScope.onFileSelect=function(a){return e.handleUpload(a,
b)}};b.prototype.handleUpload=function(a,b){var c=this;this.loading=!0;for(var e=0;e<a.length;e++)this.myScope.upload=this.upload.upload({url:SERVER+"/upload",method:"POST",file:a[e]}).progress(function(a){return console.log("percent: "+100*a.loaded/a.total)}).success(function(a,b,e,f){console.log(a.url);c.myScope.picture.url=SERVER+"/res/"+a.url;c.loading=!1}).error(function(){return console.log("error on img upload")})};return b}();c.ImgUpload=e})(app||(app={}));
(function(c){var e=function(){function b(a){var b=this;this.templateUrl="partials/templates/widget.html";this.restrict="E";this.scope={spot:"=spot"};this.timeout=a;this.link=function(a,c,e){return b.linkFn(a,c,e)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,c){localforage.setItem(a.spot.id,a.spot);this.evaluate(a)};b.prototype.evaluate=function(a){0<a.spot.media.length?(a.spot.hasImage=!0,a.spot.image=a.spot.media[0].url):a.spot.hasImage=
!1;1<=a.spot.pricing.length&&(a.spot.min=a.spot.pricing[0].amount,a.spot.max=a.spot.pricing[0].amount,a.spot.pricing.forEach(function(b,c,e){b.amount<a.spot.min&&(a.spot.min=b.amount);b.amount>a.spot.max&&(a.spot.max=b.amount)}))};return b}();c.Widget=e})(app||(app={}));
(function(c){var e=function(){function b(a){var b=this;this.timeout=a;this.templateUrl="partials/templates/widgetImg.html";this.restrict="E";this.link=function(a,c,e){return b.linkFn(a,c,e)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,c){this.handleResize(a)};b.prototype.handleResize=function(a){a.width=$("#spot-images").width();a.height=Math.round(a.width/2)};return b}();c.WidgetImg=e})(app||(app={}));
(function(c){var e=angular.module("ub","ngRoute ngResource ionic ng-back angularFileUpload filters angular-carousel angulartics angulartics.google.analytics pascalprecht.translate geolocation".split(" "));e.run(function(b){b.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0);window.StatusBar&&StatusBar.styleDefault()})});e.controller("homeCtrl",c.HomeCtrl);e.controller("menuCtrl",c.MenuCtrl);e.controller("editSpotCtrl",c.EditSpotCtrl);
e.controller("spotCtrl",c.SpotCtrl);e.service("geoService",c.GeoService);e.service("offlineService",c.OfflineService);e.service("spotService",c.SpotService);e.directive("imgUpload",c.ImgUpload.prototype.injection());e.directive("widget",c.Widget.prototype.injection());e.directive("widgetImg",c.WidgetImg.prototype.injection());e.config(function(b,a){b.state("app",{url:"/app",abstract:!0,templateUrl:"partials/menu.html",controller:"menuCtrl"}).state("app.home",{url:"/home",views:{menuContent:{templateUrl:"partials/home.html",
controller:"homeCtrl"}}}).state("app.new",{url:"/new",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.edit",{url:"/edit/:id",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.spot",{url:"/spot/:id",views:{menuContent:{templateUrl:"partials/spot.html",controller:"spotCtrl"}}}).state("app.404",{url:"/404",views:{menuContent:{templateUrl:"partials/404.html"}}}).state("app.offline",{url:"/offline",views:{menuContent:{templateUrl:"partials/offline.html"}}}).state("app.about",
{url:"/about",views:{menuContent:{templateUrl:"partials/footer/about.html"}}}).state("app.terms",{url:"/terms",views:{menuContent:{templateUrl:"partials/footer/terms.html"}}});a.otherwise("/app/home")});e.config(["$translateProvider",function(b){b.useStaticFilesLoader({prefix:"app/languages/",suffix:".json"}).preferredLanguage(LANGUAGE)}]);e.run(["$rootScope","$http","offlineService",function(b,a,c){b.$on("$stateChangeStart",function(b,e,m){a.get(SERVER+"/ping").success(function(a,b){c.setOnline()}).error(function(a,
b){c.setOffline()})})}])})(app||(app={}));
