var app;
(function(c){var e=function(){return function(f,d,b,c,e,h,k,g){"undefined"===typeof f&&(f=null);"undefined"===typeof d&&(d=null);"undefined"===typeof b&&(b=null);"undefined"===typeof c&&(c=!1);"undefined"===typeof e&&(e=new a);"undefined"===typeof h&&(h=[]);"undefined"===typeof k&&(k=[]);"undefined"===typeof g&&(g=[]);this.id=f;this.title=d;this.description=b;this.active=c;this.address=e;this.media=h;this.pricing=k;this.infrastructure=g}}();c.Spot=e;var b=function(){return function(a,d){"undefined"===typeof a&&
(a=0);"undefined"===typeof d&&(d=0);this.lat=a;this.lon=d}}();c.Position=b;var a=function(){return function(a,d,c){"undefined"===typeof a&&(a=new b);"undefined"===typeof d&&(d=0);"undefined"===typeof c&&(c=null);this.position=a;this.zip=d;this.city=c}}();c.Address=a;e=function(){return function(a){"undefined"===typeof a&&(a=null);this.url=a}}();c.Media=e;e=function(){return function(a,d){"undefined"===typeof a&&(a=null);"undefined"===typeof d&&(d=0);this.description=a;this.amount=d}}();c.Pricing=
e})(app||(app={}));(function(c){var e=function(){function b(){}b.$inject=[];return b}();c.MenuCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,f,d,b,c,e,h,k){var g=this;this.offset=0;this.radius=3;this.choose=this.lon=this.lat=0;this.phrase=null;this.spots=[];this.showLoad=this.loading=!1;this.scope=a;this.scope.vm=this;this.http=f;this.location=d;this.window=b;this.resource=c;this.timeout=e;this.offlineService=h;this.geoService=k;this.geoService.current().then(function(a){g.lat=a.coords.latitude;g.lon=a.coords.longitude;g.loadNearby()});this.window.onscroll=function(a){a=$(window).innerHeight()+
$(window).scrollTop();var d=$(document).height();a+200>=d&&g.showLoad&&(0==g.choose?g.loadNearby():g.loadByCity())}}b.prototype.reset=function(){this.offset=0;this.spots=[];0==this.choose?this.loadNearby():this.loadByCity()};b.prototype.parseRadius=function(){this.radius=parseInt(this.radius.toString())};b.prototype.loadByCity=function(){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findByCity(this.phrase,this.offset).absoluteURL()).success(function(f,d){a.spots=a.spots.concat(f);
a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==a.offset&&(a.showLoad=!0)}).error(function(f,d){a.loading=!1;a.offlineService.setOffline();a.loadOffline()})};b.prototype.loadNearby=function(){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findNearby(this.lat,this.lon,1E3*this.radius,this.offset).absoluteURL()).success(function(f,d){a.spots=a.spots.concat(f);a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==
a.offset&&(a.showLoad=!0)}).error(function(f,d){a.loading=!1;a.offlineService.setOffline();a.loadOffline()})};b.prototype.redirect=function(a){this.location.path("/app/spot/"+a)};b.prototype.loadOffline=function(){var a=this;this.showLoad=!1;for(var f=0;10>f;f++)localforage.getItem("spot-"+f,function(d){d&&a.timeout(function(){return a.spots.push(d)})})};b.prototype.saveOffline=function(){this.spots.forEach(function(a,f,d){localforage.setItem("spot-"+f,a)})};b.$inject="$scope $http $location $window $resource $timeout offlineService geoService".split(" ");
return b}();c.HomeCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,f,d,b,c,e,h,k){var g=this;this.media=[];this.pricing=[];this.pointSet=this.edit=this.loading=!1;a.vm=this;this.scope=a;this.http=d;this.location=b;this.window=c;this.geoService=h;this.offlineService=k;this.infrastructure=INFRASTRUCTURE;this.offlineService.isOnline()?(a=f.id||"new","new"===a?this.createSpot():this.loadSpot(a)):this.location.path("/app/offline");this.scope.$on("geocode",function(a,d,f){return g.geocodeFinished(d,f)})}b.prototype.addMedia=function(){this.media.push(new c.Media)};
b.prototype.deleteMedia=function(a){this.media.splice(a,1)};b.prototype.addPricing=function(){this.pricing.push(new c.Pricing(null,0))};b.prototype.deletePricing=function(a){this.pricing.splice(a,1)};b.prototype.showSummary=function(){this.loading=!0;this.geoService.geocode(this.spot.address)};b.prototype.toggleInfrastructure=function(a){var f=this.spot.infrastructure.indexOf(a);if(0<=f)return this.spot.infrastructure.splice(f,1),!1;this.spot.infrastructure.push(a);return!0};b.prototype.geocodeFinished=
function(a,f){f?(this.window.alert(f),this.loading=!1):this.edit?(this.spot.address=a,this.save()):(this.spot.address=a,this.insert())};b.prototype.insert=function(){var a=this;this.loading=!0;this.handleMedias();this.http.post(jsRoutes.controllers.Application.createSpot().absoluteURL(),this.spot).success(function(f,d){a.spot=f;a.location.path("/app/spot/"+a.spot.id)}).error(function(f,d){a.loading=!1})};b.prototype.save=function(){var a=this;this.loading=!0;this.handleMedias();this.handlePricings();
this.http.put(jsRoutes.controllers.Application.updateSpot().absoluteURL(),this.spot).success(function(f,d){a.spot=f;a.location.path("/app/spot/"+a.spot.id)}).error(function(a,d){})};b.prototype.handleMedias=function(){for(var a=this.media.length;a--;)this.media[a].url||this.media.splice(a,1);this.spot.media=this.spot.media.concat(this.media)};b.prototype.handlePricings=function(){for(var a=this.pricing.length;a--;)this.pricing[a].description||this.pricing.splice(a,1);this.spot.pricing=this.spot.pricing.concat(this.pricing)};
b.prototype.createSpot=function(){this.edit=!1;this.spot=new c.Spot;this.spot.address=new c.Address;this.createMap()};b.prototype.loadSpot=function(a){var f=this;this.pointSet=this.edit=!0;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,b){f.spot=a;f.spot||f.location.path("/app/404").replace()}).error(function(a,b){f.location.path("/app/404").replace()})};b.prototype.createMap=function(){var a=this,f=L.map("map");L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",
{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(f);this.geoService.current().then(function(a){f.setView([a.coords.latitude,a.coords.longitude],13)});this.addClickHandler(f,null);f.on("blur",function(b){return a.addClickHandler(f,null)});f.on("focus",function(b){return a.addClickHandler(f,null)})};b.prototype.addClickHandler=function(a,b){var d=this;a.on("click",function(c){d.spot.address.position.lat=c.latlng.lat;d.spot.address.position.lon=
c.latlng.lng;d.pointSet=!0;b?b.setLatLng(c.latlng):b=L.marker([c.latlng.lat,c.latlng.lng]).addTo(a)})};b.$inject="$scope $stateParams $http $location $window $timeout geoService offlineService".split(" ");return b}();c.EditSpotCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,b,d,c,e,l,h){var k=this;this.hasImage=!1;this.slideIndex=0;this.finished=!1;this.scope=a;this.scope.vm=this;this.http=b;this.location=d;this.window=l;this.sce=e;this.offlineService=h;this.oratio=this.sce.trustAsResourceUrl("//www.orat.io/js/widget/stmt.inc.min.js");this.loadSpot(c.id||"0");this.scope.$on("online",function(a){k.loadFinish()})}b.prototype.loadSpot=function(a){var b=this;console.log(a);localforage.getItem(a,function(d){b.spot=d;b.spot?(b.offlineService.isOnline()&&
b.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,b){localforage.setItem(a.id,a)}).error(function(a,c){localforage.removeItem(d.id);b.location.path("/app/404")}),b.loadFinish()):b.loadRemote(a)})};b.prototype.loadRemote=function(a){var b=this;this.http.get(jsRoutes.controllers.Application.retrieveSpot(a).absoluteURL()).success(function(a,c){a?(b.spot=a,b.spot.active?b.loadFinish():b.location.path("/app/404")):b.location.path("/app/404").replace()}).error(function(a,
c){b.location.path("/app/404").replace()})};b.prototype.loadFinish=function(){this.checkImages();this.loadMap()};b.prototype.checkImages=function(){this.spot.media&&0<this.spot.media.length&&(this.hasImage=!0)};b.prototype.loadMap=function(){var a=this.spot.address.position.lat,b=this.spot.address.position.lon,d=L.map("map").setView([a,b],13);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(d);
L.marker([a,b]).addTo(d)};b.$inject="$scope $http $location $stateParams $sce $window offlineService".split(" ");return b}();c.SpotCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a){a.vm=this;this.scope=a;this.createMap()}b.prototype.createMap=function(){var a=this;angular.extend(this.scope,{center:{lat:52.374004,lng:4.890359,zoom:7},defaults:{scrollWheelZoom:!1},events:{map:{enable:"zoomstart drag click mousemove focus blur".split(" "),logic:"broadcast"}}});this.scope.$on("leafletDirectiveMap.focus",function(b){a.scope.eventDetected="focus";angular.extend(a.scope,{events:{map:{enable:["click"],logic:"broadcast"}}})});this.scope.$on("leafletDirectiveMap.blur",
function(b){a.scope.eventDetected="blur";angular.extend(a.scope,{events:{map:{enable:["click"],logic:"broadcast"}}})});this.scope.$on("leafletDirectiveMap.drag",function(b){a.scope.eventDetected="Drag"});this.scope.$on("leafletDirectiveMap.click",function(b){a.scope.eventDetected="Click"})};b.$inject=["$scope"];return b}();c.LocationCtrl=e})(app||(app={}));
(function(c){var e=function(){function b(a,b,d){this.rootScope=a;this.http=b;this.geolocation=d}b.prototype.current=function(){return this.geolocation.getLocation()};b.prototype.geocode=function(a){var b=this;this.http.get("http://nominatim.openstreetmap.org/reverse?format=json&addressdetails=1&accept-language=en&lat="+a.position.lat+"&lon="+a.position.lon,{withCredentials:!1}).success(function(d,c){d&&d.address?(a.city=d.address.city||d.address.town||d.address.village||!d.address.hamlet?d.address.city||
d.address.town||!d.address.village?!d.address.city&&d.address.town?d.address.town:d.address.city&&"Gemeinde Wien"===d.address.city?"Vienna":d.address.city?d.address.city:d.address.state:d.address.village:d.address.hamlet,a.zip=parseInt(d.address.postcode),b.rootScope.$broadcast("geocode",a,null)):b.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")}).error(function(a,c){return b.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")})};
b.$inject=["$rootScope","$http","geolocation"];return b}();c.GeoService=e})(app||(app={}));
(function(c){var e=function(){function b(a){this.offline=!1;this.rootScope=a}b.prototype.setOnline=function(){$("#offline").hide();var a=this.offline;this.offline=!1;a&&this.rootScope.$broadcast("online")};b.prototype.setOffline=function(){$("#offline").show();var a=!this.offline;this.offline=!0;a&&this.rootScope.$broadcast("offline")};b.prototype.isOnline=function(){return!this.offline};b.prototype.isOffline=function(){return this.offline};b.$inject=["$rootScope"];return b}();c.OfflineService=e})(app||
(app={}));
(function(c){var e=function(){function b(a,b,d){var c=this;this.loading=!1;this.percentage=0;this.http=a;this.window=b;this.upload=d;this.templateUrl="partials/templates/imageUpload.html";this.restrict="E";this.link=function(a,b,d){return c.linkFn(a,b,d)}}b.prototype.injection=function(){return["$http","$window","$upload",function(a,c,d){return new b(a,c,d)}]};b.prototype.linkFn=function(a,b,d){var c=this;this.myScope=a;this.myScope.imgvm=this;this.myScope.onFileSelect=function(a){return c.handleUpload(a,b)}};
b.prototype.handleUpload=function(a,b){var d=this;console.log(a);this.loading=!0;for(var c=0;c<a.length;c++)this.myScope.upload=this.upload.upload({url:SERVER+"/upload",method:"POST",file:a[c]}).progress(function(a){return console.log("percent: "+100*a.loaded/a.total)}).success(function(a,b,c,f){console.log(a.url);d.myScope.picture.url=SERVER+"/res/"+a.url;d.loading=!1}).error(function(){return d.window.alert("Unfortunately an error occurred. Please try again later.")})};return b}();c.ImgUpload=e})(app||
(app={}));
(function(c){var e=function(){function b(a){var b=this;this.templateUrl="partials/templates/widget.html";this.restrict="E";this.scope={spot:"=spot"};this.timeout=a;this.link=function(a,c,e){return b.linkFn(a,c,e)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,d){localforage.setItem(a.spot.id,a.spot);this.evaluate(a)};b.prototype.evaluate=function(a){0<a.spot.media.length?(a.spot.hasImage=!0,a.spot.image=a.spot.media[0].url):a.spot.hasImage=
!1};return b}();c.Widget=e})(app||(app={}));
(function(c){var e=function(){function b(a){var b=this;this.timeout=a;this.templateUrl="partials/templates/widgetImg.html";this.restrict="E";this.link=function(a,c,e){return b.linkFn(a,c,e)}}b.prototype.injection=function(){return["$timeout",function(a){return new b(a)}]};b.prototype.linkFn=function(a,b,d){this.handleResize(a)};b.prototype.handleResize=function(a){a.width=$("#spot-images").width();a.height=Math.round(a.width/2)};return b}();c.WidgetImg=e})(app||(app={}));
(function(c){var e=angular.module("ub","ngRoute ngResource ionic ng-back angularFileUpload filters angular-carousel angulartics angulartics.google.analytics pascalprecht.translate geolocation leaflet-directive".split(" "));e.run(function(b){b.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0);window.StatusBar&&StatusBar.styleDefault()})});e.controller("homeCtrl",c.HomeCtrl);e.controller("menuCtrl",c.MenuCtrl);e.controller("editSpotCtrl",
c.EditSpotCtrl);e.controller("spotCtrl",c.SpotCtrl);e.controller("locationCtrl",c.LocationCtrl);e.service("geoService",c.GeoService);e.service("offlineService",c.OfflineService);e.directive("imgUpload",c.ImgUpload.prototype.injection());e.directive("widget",c.Widget.prototype.injection());e.directive("widgetImg",c.WidgetImg.prototype.injection());e.config(function(b,a){b.state("app",{url:"/app",abstract:!0,templateUrl:"partials/menu.html",controller:"menuCtrl"}).state("app.home",{url:"/home",views:{menuContent:{templateUrl:"partials/home.html",
controller:"homeCtrl"}}}).state("app.new",{url:"/new",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.edit",{url:"/edit/:id",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.spot",{url:"/spot/:id",views:{menuContent:{templateUrl:"partials/spot.html",controller:"spotCtrl"}}}).state("app.404",{url:"/404",views:{menuContent:{templateUrl:"partials/404.html"}}}).state("app.offline",{url:"/offline",views:{menuContent:{templateUrl:"partials/offline.html"}}}).state("app.about",
{url:"/about",views:{menuContent:{templateUrl:"partials/footer/about.html"}}}).state("app.terms",{url:"/terms",views:{menuContent:{templateUrl:"partials/footer/terms.html"}}});a.otherwise("/app/home")});e.config(["$translateProvider",function(b){b.useStaticFilesLoader({prefix:"app/languages/",suffix:".json"}).preferredLanguage(LANGUAGE)}]);e.run(["$rootScope","$http","offlineService",function(b,a,c){console.log("run");b.$on("$stateChangeStart",function(b,e,m){a.get(SERVER+"/ping").success(function(a,
b){console.log("online");c.setOnline()}).error(function(a,b){console.log("offline");c.setOffline()})})}])})(app||(app={}));
