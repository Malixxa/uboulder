var app;(function(d){var c=function(){return function(a,b){this.lat=a;this.lon=b}}();d.Position=c})(app||(app={}));(function(d){var c=function(){return function(a,b,f){this.position=a;this.zip=b;this.city=f}}();d.Address=c})(app||(app={}));(function(d){var c=function(){return function(a){this.url=a}}();d.Media=c})(app||(app={}));(function(d){var c=function(){return function(a,b){this.description=a;this.amount=b}}();d.Pricing=c})(app||(app={}));
(function(d){var c=function(){return function(a,b,f,e,h,d,c,g,k){this.title=a;this.active=b;this.address=f;this.media=e;this.pricing=h;this.infrastructure=d;this.id=c;this.description=g;this.website=k}}();d.Spot=c})(app||(app={}));(function(d){var c=function(){function a(){}a.$inject=[];return a}();d.MenuCtrl=c})(app||(app={}));
(function(d){var c=function(){function a(b,f,a,h,d,c){var g=this;this.radius=3;this.choose=this.lon=this.lat=0;this.phrase=null;this.scope=b;this.scope.vm=this;this.location=f;this.window=a;this.offlineService=h;this.geoService=d;this.spotService=c;this.cities=CITIES;this.geoService.current().then(function(b){g.lat=b.coords.latitude;g.lon=b.coords.longitude;g.loadNearby()});this.window.onscroll=function(b){b=$(window).innerHeight()+$(window).scrollTop();var f=$(document).height();b+200>=f&&g.spotService.showLoad&&
!g.spotService.loading&&10<=g.spotService.offset&&(0==g.choose?g.spotService.loadNearby(g.lat,g.lon,g.radius):g.spotService.loadByCity(g.phrase))}}a.prototype.reset=function(){this.spotService.reset();0==this.choose?this.loadNearby():this.loadByCity()};a.prototype.parseRadius=function(){this.radius=parseInt(this.radius.toString())};a.prototype.redirect=function(b){this.location.path("/app/spot/"+b)};a.prototype.loadByCity=function(){this.spotService.loadByCity(this.phrase)};a.prototype.loadNearby=
function(){this.spotService.loadNearby(this.lat,this.lon,this.radius)};a.$inject="$scope $location $window offlineService geoService spotService".split(" ");return a}();d.HomeCtrl=c})(app||(app={}));
(function(d){var c=function(){function a(b,f,a,h,d,c,g,k){this.media=[];this.pricing=[];this.pointSet=this.edit=this.loading=!1;b.vm=this;this.scope=b;this.http=a;this.location=h;this.window=d;this.timeout=c;this.geoService=g;this.offlineService=k;this.infrastructure=INFRASTRUCTURE;this.offlineService.isOnline()?(b=f.id||"new","new"===b?this.createSpot():this.loadSpot(b)):this.location.path("/app/offline")}a.prototype.addMedia=function(){this.media.push(new d.Media(null))};a.prototype.deleteMedia=
function(b){this.media.splice(b,1)};a.prototype.addPricing=function(){this.pricing.push(new d.Pricing(null,0))};a.prototype.deletePricing=function(b){this.pricing.splice(b,1)};a.prototype.showSummary=function(){this.loading=!0;this.edit?this.save():this.insert()};a.prototype.toggleInfrastructure=function(b){var f=this.spot.infrastructure.indexOf(b);if(0<=f)return this.spot.infrastructure.splice(f,1),!1;this.spot.infrastructure.push(b);return!0};a.prototype.insert=function(){var b=this;this.loading=
!0;this.handleMedias();this.handlePricings();this.http.post(jsRoutes.controllers.Application.createSpot().absoluteURL(),this.spot).success(function(f,a){b.spot=f;b.location.path("/app/spot/"+b.spot.id)}).error(function(f,a){b.loading=!1})};a.prototype.save=function(){var b=this;this.loading=!0;this.handleMedias();this.handlePricings();this.http.put(jsRoutes.controllers.Application.updateSpot().absoluteURL(),this.spot).success(function(f,a){b.spot=f;b.location.path("/app/spot/"+b.spot.id)}).error(function(b,
a){})};a.prototype.handleMedias=function(){for(var b=this.media.length;b--;)this.media[b].url||this.media.splice(b,1);this.spot.media=this.spot.media.concat(this.media)};a.prototype.handlePricings=function(){for(var b=this.pricing.length;b--;)this.pricing[b].description||this.pricing.splice(b,1);this.spot.pricing=this.spot.pricing.concat(this.pricing)};a.prototype.createSpot=function(){this.edit=!1;this.spot=new d.Spot(null,!1,null,[],[],[]);this.spot.address=new d.Address(new d.Position(0,0),0,null);
this.createMap()};a.prototype.loadSpot=function(b){var f=this;this.pointSet=this.edit=!0;this.http.get(jsRoutes.controllers.Application.retrieveSpot(b).absoluteURL()).success(function(b,a){f.spot=b;console.log(f.spot);f.spot||f.location.path("/app/404").replace()}).error(function(b,a){f.location.path("/app/404").replace()})};a.prototype.createMap=function(){var b=this,f=null;this.geoService.current().then(function(b){a.setCenter(new google.maps.LatLng(b.coords.latitude,b.coords.longitude))});var a=
new google.maps.Map(document.getElementById("map"),{center:{lat:48.20817400000001,lng:16.373819},zoom:15});google.maps.event.addListener(a,"click",function(h){var d=h.latLng.lat(),c=h.latLng.lng();b.spot.address.position.lat=d;b.spot.address.position.lon=c;b.timeout(function(){return b.pointSet=!0});b.geocode(h.latLng);null==f?f=new google.maps.Marker({position:h.latLng,map:a}):f.setPosition(h.latLng)})};a.prototype.geocode=function(b){var a=this;(new google.maps.Geocoder).geocode({latLng:b},function(b,
h){h==google.maps.GeocoderStatus.OK&&(0<b.length?b[0].address_components.forEach(function(b,e,h){b.types.forEach(function(e,h,d){"postal_code"==e&&(a.spot.address.zip=parseInt(b.long_name));"locality"==e&&(a.spot.address.city=b.long_name)})}):a.pointSet=!1)})};a.$inject="$scope $stateParams $http $location $window $timeout geoService offlineService".split(" ");return a}();d.EditSpotCtrl=c})(app||(app={}));
(function(d){var c=function(){function a(b,a,e,h,d,c,g){var k=this;this.hasImage=!1;this.slideIndex=0;this.finished=!1;this.scope=b;this.scope.vm=this;this.http=a;this.location=e;this.window=c;this.sce=d;this.offlineService=g;this.oratio=this.sce.trustAsResourceUrl("//www.orat.io/js/widget/stmt.inc.min.js");this.loadSpot(h.id||"0");this.scope.$on("online",function(b){k.loadFinish()})}a.prototype.loadSpot=function(b){var a=this;localforage.getItem(b,function(e){a.spot=e;a.spot?(a.offlineService.isOnline()&&
a.http.get(jsRoutes.controllers.Application.retrieveSpot(b).absoluteURL()).success(function(b,a){localforage.setItem(b.id,b)}).error(function(b,d){localforage.removeItem(e.id);a.location.path("/app/404")}),a.loadFinish()):a.loadRemote(b)})};a.prototype.loadRemote=function(b){var a=this;this.http.get(jsRoutes.controllers.Application.retrieveSpot(b).absoluteURL()).success(function(b,d){b?(a.spot=b,a.spot.active?a.loadFinish():a.location.path("/app/404")):a.location.path("/app/404").replace()}).error(function(b,
d){a.location.path("/app/404").replace()})};a.prototype.loadFinish=function(){this.checkImages();this.loadMap()};a.prototype.checkImages=function(){this.spot.media&&0<this.spot.media.length&&(this.hasImage=!0)};a.prototype.loadMap=function(){var b=this.spot.address.position.lat,a=this.spot.address.position.lon,e=L.map("map").setView([b,a],13);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(e);
L.marker([b,a]).addTo(e)};a.$inject="$scope $http $location $stateParams $sce $window offlineService".split(" ");return a}();d.SpotCtrl=c})(app||(app={}));
(function(d){var c=function(){function a(b,a,e){this.rootScope=b;this.http=a;this.geolocation=e}a.prototype.current=function(){return this.geolocation.getLocation()};a.prototype.geocode=function(b){var a=this;this.http.get("http://nominatim.openstreetmap.org/reverse?format=json&addressdetails=1&accept-language=en&lat="+b.position.lat+"&lon="+b.position.lon,{withCredentials:!1}).success(function(e,d){e&&e.address?(b.city=e.address.city||e.address.town||e.address.village||!e.address.hamlet?e.address.city||
e.address.town||!e.address.village?!e.address.city&&e.address.town?e.address.town:e.address.city&&"Gemeinde Wien"===e.address.city?"Vienna":e.address.city?e.address.city:e.address.state:e.address.village:e.address.hamlet,b.zip=parseInt(e.address.postcode),a.rootScope.$broadcast("geocode",b,null)):a.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")}).error(function(b,d){return a.rootScope.$broadcast("geocode",null,"Address not found. Please check your address information!")})};
a.$inject=["$rootScope","$http","geolocation"];return a}();d.GeoService=c})(app||(app={}));
(function(d){var c=function(){function a(b){this.offline=!1;this.rootScope=b}a.prototype.setOnline=function(){$("#offline").hide();var b=this.offline;this.offline=!1;b&&this.rootScope.$broadcast("online")};a.prototype.setOffline=function(){$("#offline").show();var b=!this.offline;this.offline=!0;b&&this.rootScope.$broadcast("offline")};a.prototype.isOnline=function(){return!this.offline};a.prototype.isOffline=function(){return this.offline};a.$inject=["$rootScope"];return a}();d.OfflineService=c})(app||
(app={}));
(function(d){var c=function(){function a(b,a,e,d){this.spots=[];this.showLoad=this.loading=!1;this.offset=0;this.rootScope=b;this.http=a;this.timeout=e;this.offlineService=d}a.prototype.loadByCity=function(b){var a=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findByCity(b,this.offset).absoluteURL()).success(function(b,d){a.spots=a.spots.concat(b);a.offset+=10;a.loading=!1;a.offlineService.setOnline();a.saveOffline();a.spots.length==a.offset&&(a.showLoad=!0)}).error(function(b,d){a.loading=
!1;a.offlineService.setOffline();a.loadOffline()})};a.prototype.loadNearby=function(b,a,d){var c=this;this.loading=!0;this.http.get(jsRoutes.controllers.Application.findNearby(b,a,1E3*d,this.offset).absoluteURL()).success(function(b,a){c.spots=c.spots.concat(b);c.offset+=10;c.loading=!1;c.offlineService.setOnline();c.saveOffline();c.spots.length==c.offset&&(c.showLoad=!0)}).error(function(b,a){c.loading=!1;c.offlineService.setOffline();c.loadOffline()})};a.prototype.reset=function(){this.offset=0;
this.spots=[]};a.prototype.loadOffline=function(){var b=this;this.showLoad=!1;for(var a=0;10>a;a++)localforage.getItem("spot-"+a,function(a){a&&b.timeout(function(){return b.spots.push(a)})})};a.prototype.saveOffline=function(){this.spots.forEach(function(b,a,c){localforage.setItem("spot-"+a,b)})};a.$inject=["$rootScope","$http","$timeout","offlineService"];return a}();d.SpotService=c})(app||(app={}));
(function(d){var c=function(){function a(b,a,c){var d=this;this.loading=!1;this.percentage=0;this.http=b;this.window=a;this.upload=c;this.templateUrl="partials/templates/imageUpload.html";this.restrict="E";this.link=function(b,a,c){return d.linkFn(b,a,c)}}a.prototype.injection=function(){return["$http","$window","$upload",function(b,c,d){return new a(b,c,d)}]};a.prototype.linkFn=function(b,a,c){var d=this;this.myScope=b;this.myScope.imgvm=this;this.myScope.onFileSelect=function(b){return d.handleUpload(b,
a)}};a.prototype.handleUpload=function(b,a){var c=this;this.loading=!0;for(var d=0;d<b.length;d++)this.myScope.upload=this.upload.upload({url:SERVER+"/upload",method:"POST",file:b[d]}).progress(function(b){return console.log("percent: "+100*b.loaded/b.total)}).success(function(b,a,d,f){console.log(b.url);c.myScope.picture.url=SERVER+"/res/"+b.url;c.loading=!1}).error(function(){return console.log("error on img upload")})};return a}();d.ImgUpload=c})(app||(app={}));
(function(d){var c=function(){function a(b){var a=this;this.templateUrl="partials/templates/widget.html";this.restrict="E";this.scope={spot:"=spot"};this.timeout=b;this.link=function(b,c,d){return a.linkFn(b,c,d)}}a.prototype.injection=function(){return["$timeout",function(b){return new a(b)}]};a.prototype.linkFn=function(b,a,c){localforage.setItem(b.spot.id,b.spot);this.evaluate(b)};a.prototype.evaluate=function(b){0<b.spot.media.length?(b.spot.hasImage=!0,b.spot.image=b.spot.media[0].url):b.spot.hasImage=
!1;1<=b.spot.pricing.length&&(b.spot.min=b.spot.pricing[0].amount,b.spot.max=b.spot.pricing[0].amount,b.spot.pricing.forEach(function(a,c,d){a.amount<b.spot.min&&(b.spot.min=a.amount);a.amount>b.spot.max&&(b.spot.max=a.amount)}))};return a}();d.Widget=c})(app||(app={}));
(function(d){var c=function(){function a(b){var a=this;this.timeout=b;this.templateUrl="partials/templates/widgetImg.html";this.restrict="E";this.link=function(b,c,d){return a.linkFn(b,c,d)}}a.prototype.injection=function(){return["$timeout",function(b){return new a(b)}]};a.prototype.linkFn=function(b,a,c){this.handleResize(b)};a.prototype.handleResize=function(a){a.width=$("#spot-images").width();a.height=Math.round(a.width/2)};return a}();d.WidgetImg=c})(app||(app={}));
(function(d){var c=angular.module("ub","ngRoute ngResource ionic ng-back angularFileUpload filters angular-carousel angulartics angulartics.google.analytics pascalprecht.translate geolocation".split(" "));c.run(function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0);window.StatusBar&&StatusBar.styleDefault()})});c.controller("homeCtrl",d.HomeCtrl);c.controller("menuCtrl",d.MenuCtrl);c.controller("editSpotCtrl",d.EditSpotCtrl);
c.controller("spotCtrl",d.SpotCtrl);c.service("geoService",d.GeoService);c.service("offlineService",d.OfflineService);c.service("spotService",d.SpotService);c.directive("imgUpload",d.ImgUpload.prototype.injection());c.directive("widget",d.Widget.prototype.injection());c.directive("widgetImg",d.WidgetImg.prototype.injection());c.config(function(a,b){a.state("app",{url:"/app",abstract:!0,templateUrl:"partials/menu.html",controller:"menuCtrl"}).state("app.home",{url:"/home",views:{menuContent:{templateUrl:"partials/home.html",
controller:"homeCtrl"}}}).state("app.new",{url:"/new",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.edit",{url:"/edit/:id",views:{menuContent:{templateUrl:"partials/new.html",controller:"editSpotCtrl"}}}).state("app.spot",{url:"/spot/:id",views:{menuContent:{templateUrl:"partials/spot.html",controller:"spotCtrl"}}}).state("app.404",{url:"/404",views:{menuContent:{templateUrl:"partials/404.html"}}}).state("app.offline",{url:"/offline",views:{menuContent:{templateUrl:"partials/offline.html"}}}).state("app.about",
{url:"/about",views:{menuContent:{templateUrl:"partials/footer/about.html"}}}).state("app.terms",{url:"/terms",views:{menuContent:{templateUrl:"partials/footer/terms.html"}}});b.otherwise("/app/home")});c.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"app/languages/",suffix:".json"}).preferredLanguage(LANGUAGE)}]);c.run(["$rootScope","$http","offlineService",function(a,b,c){a.$on("$stateChangeStart",function(a,d,l){b.get(SERVER+"/ping").success(function(a,b){c.setOnline()}).error(function(a,
b){c.setOffline()})})}])})(app||(app={}));
